<!doctype html>
<html>
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><title>Admin — Orders</title>
<style>body{font-family:Arial;padding:18px;max-width:1000px;margin:auto;background:#fff} input{padding:8px;border:1px solid #ddd;border-radius:6px}</style>
</head>
<body>
  <h1>Orders — Admin</h1>
  <div style="margin-bottom:10px">Admin token: <input id="token" placeholder="Enter admin token" style="width:320px" /> <button id="load">Load orders</button></div>
  <div id="orders"></div>
  <script src="/app.js"></script>
  <script>
    async function loadOrders(){
      const token = document.getElementById('token').value;
      if(!token) return alert('Enter token');
      const res = await fetch('/api/orders', { headers: { 'x-admin-token': token }});
      if (!res.ok) return alert('Auth failed or server error');
      const j = await res.json();
      const out = document.getElementById('orders');
      out.innerHTML = '';
      j.orders.forEach(o => {
        const div = document.createElement('div');
        div.style.border='1px solid #ddd';div.style.padding='10px';div.style.marginBottom='8px';
        div.innerHTML = `
          <div><strong>#${o.id}</strong> — <em>${o.status}</em> — ${o.created_at}</div>
          <div>${o.name} | ${o.phone} | ${o.email || ''}</div>
          <div><strong>${o.product}</strong></div>
          <div style="margin-top:6px">${o.details || ''}</div>
          <div style="margin-top:8px">
            <select data-id="${o.id}" class="status">
              <option value="pending">pending</option>
              <option value="processing">processing</option>
              <option value="done">done</option>
              <option value="cancelled">cancelled</option>
            </select>
            <button data-id="${o.id}" class="save">Save</button>
            <button data-id="${o.id}" class="del">Delete</button>
          </div>
        `;
        out.appendChild(div);
        div.querySelector('.status').value = o.status;
      });

      // attach handlers
      document.querySelectorAll('.save').forEach(b=>b.onclick = async ()=>{
        const id = b.getAttribute('data-id');
        const status = document.querySelector(`select[data-id="${id}"]`).value;
        const token = document.getElementById('token').value;
        await fetch(`/api/orders/${id}`, { method:'PUT', headers: { 'Content-Type':'application/json', 'x-admin-token': token }, body: JSON.stringify({ status })});
        alert('Updated');
        loadOrders();
      });
      document.querySelectorAll('.del').forEach(b=>b.onclick = async ()=>{
        if(!confirm('Delete this order?')) return;
        const id = b.getAttribute('data-id');
        const token = document.getElementById('token').value;
        await fetch(`/api/orders/${id}`, { method:'DELETE', headers: { 'x-admin-token': token }});
        alert('Deleted');
        loadOrders();
      });
    }

    document.getElementById('load').addEventListener('click', loadOrders);
  </script>
</body>
</html>
